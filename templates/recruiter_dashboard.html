<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Recruiter Dashboard | Sudeshm Jobs - Interns </title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            background-color: #f4f6f9;
        }

        .dashboard {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 260px;
            background: linear-gradient(180deg, #4f46e5, #4338ca);
            color: white;
            padding: 25px 20px;
        }

        .sidebar h4 {
            text-align: center;
            font-weight: 700;
            margin-bottom: 30px;
        }

        .sidebar a {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 14px;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 8px;
            transition: 0.3s;
        }

        .sidebar a:hover,
        .sidebar a.active {
            background: rgba(255,255,255,0.15);
        }

        .sidebar a.disabled {
            opacity: 0.6;
            pointer-events: none;
        }

        .content {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
        }

        .stat-card, .info-card {
            background: white;
            padding: 22px;
            border-radius: 14px;
            box-shadow: 0 12px 30px rgba(0,0,0,0.08);
        }

        .stat-card i {
            font-size: 28px;
            color: #4f46e5;
        }

        .btn-primary-custom {
            background: #4f46e5;
            color: white;
            border-radius: 25px;
            padding: 10px 25px;
            border: none;
        }

        .btn-primary-custom:hover {
            background: #4338ca;
        }

        .locked-content {
            filter: blur(4px);
            position: relative;
        }

        .locked-content {
            filter: blur(4px);
            position: relative;
        }

        .locked-content::after {
            content: "ðŸ”’ Complete profile & wait for admin approval";
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.1rem;
            color: #555;
            pointer-events: none; 
        }

        .progress-bar-custom {
            height: 8px;
            background: #e9ecef;
            border-radius: 5px;
            width: 160px;
            overflow: hidden;
        }

        .completion-banner {
            background: white;
            border-left: 4px solid #ffc107;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .completion-banner h6 {
            color: #ffc107;
        }
    </style>
</head>

<body>

<div class="dashboard">

    <!-- SIDEBAR -->
    <aside class="sidebar">
        <h4>Recruiter Panel</h4>

        <a href="/recruiter-dashboard" class="{{ 'active' if request.path == '/recruiter-dashboard' }}">
            <i class="bi bi-speedometer2"></i> Dashboard
        </a>

        <a href="/recruiter-dashboard?tab=profile" class="{{ 'active' if request.path == '/recruiter-dashboard' and (tab=='profile') }}">
            <i class="bi bi-person"></i> Profile
        </a>

            <a href="/recruiter-dashboard?tab=jobs" class="{{ 'active' if request.path == '/recruiter-dashboard' and (tab=='jobs') }}">
                <i class="bi bi-briefcase"></i> Posted Jobs
            </a>

        <a href="/applications" class="{{ 'active' if request.path == '/applications' }}"><i class="bi bi-file-earmark-text"></i> Applications</a>
        <a href="/interviews" class="{{ 'active' if request.path == '/interviews' }}"><i class="bi bi-calendar-event"></i> Interviews</a>
        <a href="#" class="{{ 'active' if request.path == '/offers' }}"><i class="bi bi-envelope"></i> Offers</a>

        <a href="/logout"><i class="bi bi-box-arrow-right"></i> Logout</a>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="content">

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        {% if not is_complete %}
        <div class="completion-banner">
            <div>
                <h6 class="fw-bold mb-1">
            </body>
            <script>
                function toggleEditMode(show) {
                    const edit = document.getElementById('edit-mode');
                    const view = document.getElementById('view-mode');
                    if (!edit) return;
                    if (show) {
                        edit.classList.remove('d-none');
                        if (view) view.classList.add('d-none');
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    } else {
                        edit.classList.add('d-none');
                        if (view) view.classList.remove('d-none');
                    }
                }

                function toggleView(show) {
                    const edit = document.getElementById('edit-mode');
                    const view = document.getElementById('view-mode');
                    if (!view) return;
                    if (show) {
                        view.classList.remove('d-none');
                        if (edit) edit.classList.add('d-none');
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                }
            </script>
                    {% if profile_percent < 100 %}
                        Profile Incomplete
                    {% else %}
                        Awaiting Admin Approval
                    {% endif %}
                </h6>
                <p class="mb-0 small text-muted">
                    {% if profile_percent < 100 %}
                        Complete your profile to unlock hiring features
                    {% else %}
                        Your company profile is under admin verification
                    {% endif %}
                </p>
            </div>

            <div>
                <div class="small fw-bold mb-1">{{ profile_percent }}% Complete</div>
                <div class="progress-bar-custom">
                    <div class="bg-warning h-100" style="width: {{ profile_percent }}%"></div>
                </div>
            </div>

            <a href="/recruiter-dashboard?tab=profile" class="btn btn-primary-custom">
                Complete Profile
            </a>
        </div>
        {% endif %}

        <div class="{% if not is_complete and (tab!='profile') %}locked-content{% endif %}">
            {% block dashboard_content %}

            {% if tab=='profile' %}
            <div class="d-flex justify-content-between align-items-center mb-3">
                <div>
                    <h3 class="fw-bold mb-1">Recruiter Profile</h3>
                    <div class="d-flex align-items-center mt-1">
                        <div class="me-3 small fw-bold">Completion: {{ profile_percent or 0 }}%</div>
                        <div class="progress-bar-custom" style="width: 240px;">
                            <div class="bg-warning h-100" style="width: {{ profile_percent or 0 }}%"></div>
                        </div>
                    </div>
                </div>
                <div class="d-flex flex-wrap gap-2">
                    {% if profile %}
                    <button type="button" class="btn btn-outline-info btn-sm" onclick="toggleView(true)">
                        <i class="bi bi-eye me-1"></i> View
                    </button>
                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="toggleEditMode(true)">
                        <i class="bi bi-pencil me-1"></i> Edit
                    </button>
                    <form method="POST" action="/recruiter/delete-profile" onsubmit="return confirm('Delete your recruiter profile?');" class="d-inline">
                        <button type="submit" class="btn btn-outline-danger btn-sm">
                            <i class="bi bi-trash me-1"></i> Delete
                        </button>
                    </form>
                    {% endif %}
                </div>
            </div>

            {% if profile %}
            <div id="view-mode" class="info-card mb-3">
                <div class="d-flex align-items-center mb-1">
                    {% if profile.logo_file %}
                        <img src="{{ url_for('static', filename='uploads/' + profile.logo_file) }}" alt="Company Logo" style="max-height: 180px; max-width: 400px; object-fit: contain;" class="me-2">
                    {% endif %}
                    <div class="fw-bold fs-1">{{ profile.company_name }}</div>
                </div>
                <div class="row mb-2">
                    <div class="col-md-6">
                        <small class="text-muted d-block">Name</small>
                        <div class="fw-semibold">{{ profile.full_name }}</div>
                    </div>
                    <div class="col-md-6">
                        <small class="text-muted d-block">Phone</small>
                        <div class="fw-semibold">{{ profile.phone }}</div>
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-md-6">
                        <small class="text-muted d-block">Designation</small>
                        <div class="fw-semibold">{{ profile.designation }}</div>
                    </div>
                    <div class="col-md-6">
                        <small class="text-muted d-block">LinkedIn</small>
                        {% if profile.linkedin %}<a href="{{ profile.linkedin }}" target="_blank">{{ profile.linkedin }}</a>{% else %}<span class="text-muted">N/A</span>{% endif %}
                    </div>
                </div>
                <hr>
                <div class="row mb-2">
                    <div class="col-md-6">
                        <small class="text-muted d-block">Company Name</small>
                        <div class="fw-semibold">{{ profile.company_name }}</div>
                    </div>
                    <div class="col-md-3">
                        <small class="text-muted d-block">Type</small>
                        <div class="fw-semibold">{{ profile.company_type or 'N/A' }}</div>
                    </div>
                    <div class="col-md-3">
                        <small class="text-muted d-block">Size</small>
                        <div class="fw-semibold">{{ profile.company_size or 'N/A' }}</div>
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-md-4">
                        <small class="text-muted d-block">Industry</small>
                        <div class="fw-semibold">{{ profile.industry or 'N/A' }}</div>
                    </div>
                    <div class="col-md-4">
                        <small class="text-muted d-block">Website</small>
                        {% if profile.website %}<a href="{{ profile.website }}" target="_blank">{{ profile.website }}</a>{% else %}<span class="text-muted">N/A</span>{% endif %}
                    </div>
                    <div class="col-md-4">
                        <small class="text-muted d-block">Address</small>
                        <div class="fw-semibold">{{ profile.address or 'N/A' }}</div>
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-md-4">
                        <small class="text-muted d-block">Roles</small>
                        <div class="fw-semibold">{{ profile.roles or 'N/A' }}</div>
                    </div>
                    <div class="col-md-4">
                        <small class="text-muted d-block">Experience Levels</small>
                        <div class="fw-semibold">{{ profile.experience_levels or 'N/A' }}</div>
                    </div>
                    <div class="col-md-4">
                        <small class="text-muted d-block">Job Types</small>
                        <div class="fw-semibold">{{ profile.job_types or 'N/A' }}</div>
                    </div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-md-6">
                        <small class="text-muted d-block">Registration Doc</small>
                        {% if profile.company_doc %}
                        <a href="{{ url_for('static', filename='uploads/' + profile.company_doc) }}" target="_blank">View</a>
                        {% else %}<span class="text-muted">N/A</span>{% endif %}
                    </div>
                    <div class="col-md-6">
                        <small class="text-muted d-block">Authorization Doc</small>
                        {% if profile.auth_doc %}
                        <a href="{{ url_for('static', filename='uploads/' + profile.auth_doc) }}" target="_blank">View</a>
                        {% else %}<span class="text-muted">N/A</span>{% endif %}
                    </div>
                </div>
            </div>
            {% endif %}

            <div id="edit-mode" class="info-card {% if profile %}d-none{% endif %}">
                <form method="POST" action="/save-recruiter-profile" enctype="multipart/form-data">
                    <h6 class="fw-bold mb-2">Section 1: Personal Info</h6>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Name</label>
                            <input type="text" name="full_name" class="form-control" value="{{ profile.full_name if profile }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Phone</label>
                            <input type="text" name="phone" class="form-control" value="{{ profile.phone if profile }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Designation</label>
                            <input type="text" name="designation" class="form-control" value="{{ profile.designation if profile }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">LinkedIn</label>
                            <input type="url" name="linkedin" class="form-control" value="{{ profile.linkedin if profile }}">
                        </div>
                    </div>

                    <h6 class="fw-bold mb-2">Section 2: Company Info</h6>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Company Name</label>
                            <input type="text" name="company_name" class="form-control" value="{{ profile.company_name if profile }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Type</label>
                            <input type="text" name="company_type" class="form-control" value="{{ profile.company_type if profile }}">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Size</label>
                            <input type="text" name="company_size" class="form-control" value="{{ profile.company_size if profile }}">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Industry</label>
                            <input type="text" name="industry" class="form-control" value="{{ profile.industry if profile }}">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Website</label>
                            <input type="url" name="website" class="form-control" value="{{ profile.website if profile }}">
                        </div>
                        <div class="col-md-12 mb-3">
                            <label class="form-label">Address</label>
                            <input type="text" name="address" class="form-control" value="{{ profile.address if profile }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Company Logo</label>
                            <input type="file" name="logo_file" class="form-control">
                            {% if profile and profile.logo_file %}
                            <small class="text-muted">Current: {{ profile.logo_file }}</small>
                            {% endif %}
                        </div>
                    </div>

                    <h6 class="fw-bold mb-2">Section 3: Hiring Preferences</h6>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Roles</label>
                            <input type="text" name="roles" class="form-control" value="{{ profile.roles if profile }}" placeholder="e.g., Frontend, Backend">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Experience Levels</label>
                            <input type="text" name="experience_levels" class="form-control" value="{{ profile.experience_levels if profile }}" placeholder="e.g., Junior, Mid, Senior">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Job Types</label>
                            <input type="text" name="job_types" class="form-control" value="{{ profile.job_types if profile }}" placeholder="e.g., Full-time, Contract">
                        </div>
                    </div>

                    <h6 class="fw-bold mb-2">Section 4: Verification Docs</h6>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Registration Doc</label>
                            <input type="file" name="company_doc" class="form-control">
                            {% if profile and profile.company_doc %}
                            <small class="text-muted">Current: {{ profile.company_doc }}</small>
                            {% endif %}
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Authorization Doc</label>
                            <input type="file" name="auth_doc" class="form-control">
                            {% if profile and profile.auth_doc %}
                            <small class="text-muted">Current: {{ profile.auth_doc }}</small>
                            {% endif %}
                        </div>
                    </div>

                    <div class="text-end">
                        <button type="submit" class="btn btn-primary-custom">
                            <i class="bi bi-check-circle me-2"></i>Save Profile
                        </button>
                    </div>
                </form>
            </div>
            
            {% elif tab=='overview' %}
            <h3 class="fw-bold mb-4">Recruiter Dashboard</h3>

            <!-- STATS -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="stat-card text-center">
                        <i class="bi bi-briefcase"></i>
                        <h4>{{ jobs_count }}</h4>
                        <p>Jobs Posted</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card text-center">
                        <i class="bi bi-people"></i>
                        <h4>{{ applications_count }}</h4>
                        <p>Applications</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card text-center">
                        <i class="bi bi-calendar-check"></i>
                        <h4>{{ interviews_count }}</h4>
                        <p>Interviews</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card text-center">
                        <i class="bi bi-award"></i>
                        <h4>{{ offers_count }}</h4>
                        <p>Offers Sent</p>
                    </div>
                </div>
            </div>

            <!-- EXTRA INFO -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="info-card">
                        <h6 class="fw-bold mb-2">Verification Status</h6>
                        {% if verification_status == 'approved' %}
                            <span class="badge bg-success">Verified</span>
                        {% elif verification_status == 'rejected' %}
                            <span class="badge bg-danger">Rejected</span>
                        {% else %}
                            <span class="badge bg-warning text-dark">Pending Admin Verification</span>
                        {% endif %}
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="info-card">
                        <h6 class="fw-bold mb-2">Upcoming Interviews</h6>
                        <ul class="small mb-0">
                            <li>10:00 AM â€“ Frontend Dev</li>
                            <li>2:30 PM â€“ Data Analyst</li>
                        </ul>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="info-card">
                        <h6 class="fw-bold mb-2">AI Insight</h6>
                        <p class="small mb-0">
                            Low response detected on one job. Suggested skills: React, Docker
                        </p>
                    </div>
                </div>
            </div>

            <!-- QUICK ACTIONS -->
            <div class="info-card">
                <h6 class="fw-bold mb-3">Quick Actions</h6>

                    <a href="/recruiter-dashboard?tab=post" class="btn btn-primary-custom me-2">
                        <i class="bi bi-plus-circle"></i> Post Job
                    </a>

                <a href="/applications" class="btn btn-outline-primary rounded-pill px-4 me-2">
                    View Applications
                </a>

                <a href="/interviews" class="btn btn-outline-primary rounded-pill px-4">
                    Schedule Interview
                </a>
            </div>
            
            {% elif tab=='post' %}
            <div class="card border-0 shadow-sm mt-4">
                <div class="card-header bg-primary text-white"><strong>Create Job Posting</strong></div>
                <div class="card-body">
                    <form method="POST" action="/save-job">
                        <h6 class="fw-bold">Job Information</h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Job Title</label>
                                <input name="title" type="text" class="form-control" placeholder="eg: Software Engineer" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Department</label>
                                <input name="department" type="text" class="form-control" placeholder="eg: Engineering">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Job Type</label>
                                <select name="job_type" class="form-select">
                                    <option selected>Full-Time</option>
                                    <option>Part-Time</option>
                                    <option>Internship</option>
                                    <option>Contract</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Employment Mode</label>
                                <select name="employment_mode" class="form-select">
                                    <option selected>Onsite</option>
                                    <option>Remote</option>
                                    <option>Hybrid</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">No. of Openings</label>
                                <input name="openings" type="number" min="1" class="form-control">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Job Description</label>
                            <textarea name="description" class="form-control" rows="4"></textarea>
                        </div>

                        <h6 class="fw-bold">Skills & Qualifications</h6>
                        <div class="mb-3">
                            <label class="form-label">Required Skills</label>
                            <input name="skills" type="text" class="form-control" placeholder="Python, Flask, React">
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Min Experience (Years)</label>
                                <input name="min_experience" type="number" class="form-control">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Max Experience (Years)</label>
                                <input name="max_experience" type="number" class="form-control">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Education Level</label>
                                <input name="education" type="text" class="form-control" placeholder="Diploma, Graduate, ...">
                            </div>
                        </div>

                        <h6 class="fw-bold">Location & Salary</h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Job Location</label>
                                <input name="location" type="text" class="form-control" placeholder="City or Remote">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Salary Min</label>
                                <input name="salary_min" type="number" class="form-control">
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Salary Max</label>
                                <input name="salary_max" type="number" class="form-control">
                            </div>
                        </div>

                        <h6 class="fw-bold">Application Details</h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Application Deadline</label>
                                <input name="deadline" type="date" class="form-control">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Interview Mode</label>
                                <select name="interview_mode" class="form-select">
                                    <option>Online</option>
                                    <option>Offline</option>
                                </select>
                            </div>
                        </div>

                        <div class="text-end">
                            <button type="submit" class="btn btn-success px-4"><i class="bi bi-check2-circle me-1"></i>Post Job</button>
                        </div>
                    </form>
                </div>
            </div>
            {% elif tab=='jobs' %}
            <!-- Enhanced Posted Jobs Section -->
            <div class="mb-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div>
                        <h3 class="fw-bold mb-1">Posted Jobs</h3>
                        <p class="text-muted small mb-0">Manage and track all your job postings</p>
                    </div>
                    <a href="/recruiter-dashboard?tab=post" class="btn btn-primary-custom">
                        <i class="bi bi-plus-circle me-2"></i>Post New Job
                    </a>
                </div>

                <!-- Filters & Search -->
                <div class="card border-0 shadow-sm mb-3">
                    <div class="card-body p-3">
                        <div class="row g-3">
                            <div class="col-md-5">
                                <div class="input-group">
                                    <span class="input-group-text bg-white border-end-0"><i class="bi bi-search"></i></span>
                                    <input type="text" id="jobSearchInput" class="form-control border-start-0" placeholder="Search jobs by title, department...">
                                </div>
                            </div>
                            <div class="col-md-2">
                                <select class="form-select" id="statusFilter">
                                    <option value="">All Status</option>
                                    <option value="Active">Active</option>
                                    <option value="Closed">Closed</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <select class="form-select" id="typeFilter">
                                    <option value="">All Types</option>
                                    <option value="Full-Time">Full-Time</option>
                                    <option value="Part-Time">Part-Time</option>
                                    <option value="Internship">Internship</option>
                                    <option value="Contract">Contract</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <select class="form-select" id="sortBy">
                                    <option value="recent">Most Recent</option>
                                    <option value="oldest">Oldest First</option>
                                    <option value="applicants">Most Applicants</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                {% if jobs %}
                    <!-- Jobs List -->
                    {% for job in jobs %}
                    <div class="card border-0 shadow-sm mb-3 job-card" data-job-id="{{ job.id }}">
                        <div class="card-body p-4">
                            <div class="row align-items-start">
                                <!-- Left: Job Info -->
                                <div class="col-md-8">
                                    <div class="d-flex align-items-start mb-2">
                                        <div class="flex-grow-1">
                                            <h5 class="fw-bold mb-1">{{ job.title }}</h5>
                                            <div class="d-flex flex-wrap gap-2 mb-2">
                                                <span class="badge bg-light text-dark border"><i class="bi bi-building me-1"></i>{{ job.department or 'General' }}</span>
                                                <span class="badge bg-primary">{{ job.job_type or 'Full-Time' }}</span>
                                                <span class="badge bg-info text-dark"><i class="bi bi-geo-alt me-1"></i>{{ job.employment_mode or job.location or 'Onsite' }}</span>
                                                {% if job.salary_min and job.salary_max %}
                                                <span class="badge bg-success"><i class="bi bi-currency-dollar me-1"></i>{{ job.salary_min }}k - {{ job.salary_max }}k</span>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div>
                                            {% if job.deadline and job.deadline < today %}
                                                <span class="badge bg-secondary px-3 py-2">Closed</span>
                                            {% else %}
                                                <span class="badge bg-success px-3 py-2">Active</span>
                                            {% endif %}
                                        </div>
                                    </div>

                                    <div class="row g-3 small text-muted">
                                        <div class="col-auto">
                                            <i class="bi bi-briefcase me-1"></i>{{ job.min_experience or 0 }}-{{ job.max_experience or 0 }} years
                                        </div>
                                        <div class="col-auto">
                                            <i class="bi bi-calendar-event me-1"></i>Posted: {{ job.created_at.strftime('%b %d, %Y') if job.created_at else 'N/A' }}
                                        </div>
                                        <div class="col-auto">
                                            <i class="bi bi-clock me-1"></i>Deadline: {{ job.deadline.strftime('%b %d, %Y') if job.deadline else 'No deadline' }}
                                        </div>
                                        <div class="col-auto">
                                            <i class="bi bi-people me-1"></i>Openings: {{ job.openings or 1 }}
                                        </div>
                                    </div>
                                </div>

                                <!-- Right: Stats & Actions -->
                                <div class="col-md-4">
                                    <!-- Applicant Pipeline -->
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <span class="small text-muted">Applicants Pipeline</span>
                                            <span class="badge bg-primary-subtle text-primary">{{ job.application_count or 0 }} Total</span>
                                        </div>
                                        <div class="d-flex gap-1 mb-1">
                                            <div class="flex-fill bg-primary" style="height: 4px; opacity: 0.8;"></div>
                                            <div class="flex-fill bg-info" style="height: 4px; opacity: 0.6;"></div>
                                            <div class="flex-fill bg-warning" style="height: 4px; opacity: 0.4;"></div>
                                            <div class="flex-fill bg-success" style="height: 4px; opacity: 0.2;"></div>
                                        </div>
                                        <div class="d-flex justify-content-between small text-muted">
                                            <span>Applied</span>
                                            <span>Shortlisted</span>
                                            <span>Interview</span>
                                            <span>Offered</span>
                                        </div>
                                    </div>

                                    <!-- Actions -->
                                    <div class="d-flex flex-wrap gap-2">
                                        <a href="/view-job/{{ job.id }}" class="btn btn-sm btn-outline-primary" title="View Details">
                                            <i class="bi bi-eye"></i>
                                        </a>
                                        <a href="/recruiter-dashboard?tab=edit-job&job_id={{ job.id }}" class="btn btn-sm btn-outline-secondary" title="Edit Job">
                                            <i class="bi bi-pencil"></i>
                                        </a>
                                        <button
                                            class="btn btn-sm btn-outline-info"
                                            data-job-id="{{ job.id }}"
                                            onclick="shareJob(this)"
                                            title="Share Link">
                                            <i class="bi bi-share"></i>
                                        </button>
                                        <form action="/duplicate-job/{{ job.id }}" method="POST" class="d-inline">
                                            <button type="submit" class="btn btn-sm btn-outline-warning" title="Duplicate">
                                                <i class="bi bi-files"></i>
                                            </button>
                                        </form>
                                        <form action="/toggle-job-status/{{ job.id }}" method="POST" class="d-inline">
                                            <button type="submit" class="btn btn-sm btn-outline-success" title="{% if job.deadline and job.deadline >= today %}Pause Job{% else %}Resume Job{% endif %}">
                                                <i class="bi bi-{% if job.deadline and job.deadline >= today %}pause-circle{% else %}play-circle{% endif %}"></i>
                                            </button>
                                        </form>
                                        <form action="/delete-job/{{ job.id }}" method="POST" class="d-inline" onsubmit="return confirm('Archive this job posting?');">
                                            <button type="submit" class="btn btn-sm btn-outline-danger" title="Archive">
                                                <i class="bi bi-archive"></i>
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>

                            <!-- Expandable Details -->
                            <div class="collapse mt-3 pt-3 border-top" id="jobDetails{{ job.id }}">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6 class="fw-bold mb-2">Job Description</h6>
                                        <p class="small text-muted">{{ job.description or 'No description provided.' }}</p>
                                    </div>
                                    <div class="col-md-3">
                                        <h6 class="fw-bold mb-2">Required Skills</h6>
                                        <div class="d-flex flex-wrap gap-1">
                                            {% if job.skills %}
                                                {% for skill in job.skills.split(',')[:5] %}
                                                <span class="badge bg-light text-dark border small">{{ skill.strip() }}</span>
                                                {% endfor %}
                                            {% else %}
                                                <span class="text-muted small">Not specified</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <h6 class="fw-bold mb-2">Education</h6>
                                        <p class="small text-muted">{{ job.education or 'Not specified' }}</p>
                                        <h6 class="fw-bold mb-2 mt-3">Interview Mode</h6>
                                        <p class="small text-muted">{{ job.interview_mode or 'Not specified' }}</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Toggle Details Button -->
                            <div class="text-center mt-2">
                                <button class="btn btn-sm btn-link text-decoration-none" type="button" data-bs-toggle="collapse" data-bs-target="#jobDetails{{ job.id }}">
                                    <span class="show-more">Show More <i class="bi bi-chevron-down"></i></span>
                                    <span class="show-less d-none">Show Less <i class="bi bi-chevron-up"></i></span>
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endfor %}

                {% else %}
                    <!-- Empty State -->
                    <div class="card border-0 shadow-sm">
                        <div class="card-body text-center py-5">
                            <div class="mb-3">
                                <i class="bi bi-briefcase text-muted" style="font-size: 4rem;"></i>
                            </div>
                            <h5 class="fw-bold mb-2">No Jobs Posted Yet</h5>
                            <p class="text-muted mb-4">Start by creating your first job posting to attract top talent.</p>
                            <a href="/recruiter-dashboard?tab=post" class="btn btn-primary-custom px-4">
                                <i class="bi bi-plus-circle me-2"></i>Post Your First Job
                            </a>
                        </div>
                    </div>
                {% endif %}
            </div>

            {% elif tab=='edit-job' %}
            <!-- Edit Job Section -->
            <div class="mb-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3 class="fw-bold mb-0">Edit Job</h3>
                    <a href="/recruiter-dashboard?tab=jobs" class="btn btn-outline-secondary">
                        <i class="bi bi-arrow-left me-2"></i>Back to Jobs
                    </a>
                </div>

                {% if edit_job %}
                <div class="card border-0 shadow-sm">
                    <div class="card-body p-4">
                        <form method="POST" action="/edit-job/{{ edit_job.id }}">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">Job Title *</label>
                                    <input type="text" name="title" class="form-control" value="{{ edit_job.title }}" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">Department *</label>
                                    <input type="text" name="department" class="form-control" value="{{ edit_job.department }}" required>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label class="form-label fw-semibold">Location *</label>
                                    <input type="text" name="location" class="form-control" value="{{ edit_job.location }}" required>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label fw-semibold">Job Type *</label>
                                    <select name="job_type" class="form-select" required>
                                        <option value="Full-Time" {% if edit_job.job_type == 'Full-Time' %}selected{% endif %}>Full-Time</option>
                                        <option value="Part-Time" {% if edit_job.job_type == 'Part-Time' %}selected{% endif %}>Part-Time</option>
                                        <option value="Contract" {% if edit_job.job_type == 'Contract' %}selected{% endif %}>Contract</option>
                                        <option value="Internship" {% if edit_job.job_type == 'Internship' %}selected{% endif %}>Internship</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label fw-semibold">Employment Mode *</label>
                                    <select name="employment_mode" class="form-select" required>
                                        <option value="Onsite" {% if edit_job.employment_mode == 'Onsite' %}selected{% endif %}>Onsite</option>
                                        <option value="Remote" {% if edit_job.employment_mode == 'Remote' %}selected{% endif %}>Remote</option>
                                        <option value="Hybrid" {% if edit_job.employment_mode == 'Hybrid' %}selected{% endif %}>Hybrid</option>
                                    </select>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">Minimum Salary</label>
                                    <input type="number" name="salary_min" class="form-control" value="{{ edit_job.salary_min }}" placeholder="e.g., 50000">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">Maximum Salary</label>
                                    <input type="number" name="salary_max" class="form-control" value="{{ edit_job.salary_max }}" placeholder="e.g., 80000">
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">Minimum Experience (Years) *</label>
                                    <input type="number" name="min_experience" class="form-control" value="{{ edit_job.min_experience }}" required min="0">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-semibold">Maximum Experience (Years) *</label>
                                    <input type="number" name="max_experience" class="form-control" value="{{ edit_job.max_experience }}" required min="0">
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label class="form-label fw-semibold">Education Required *</label>
                                    <input type="text" name="education" class="form-control" value="{{ edit_job.education }}" placeholder="e.g., Bachelor's Degree" required>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label fw-semibold">Number of Openings *</label>
                                    <input type="number" name="openings" class="form-control" value="{{ edit_job.openings }}" required min="1">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label fw-semibold">Application Deadline</label>
                                    <input type="date" name="deadline" class="form-control" value="{{ edit_job.deadline }}">
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-semibold">Job Description *</label>
                                <textarea name="description" class="form-control" rows="6" required>{{ edit_job.description }}</textarea>
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-semibold">Required Skills *</label>
                                <textarea name="skills" class="form-control" rows="3" placeholder="e.g., Python, JavaScript, SQL" required>{{ edit_job.skills }}</textarea>
                            </div>

                            <div class="mb-4">
                                <label class="form-label fw-semibold">Interview Mode *</label>
                                <select name="interview_mode" class="form-select" required>
                                    <option value="Online" {% if edit_job.interview_mode == 'Online' %}selected{% endif %}>Online</option>
                                    <option value="In-Person" {% if edit_job.interview_mode == 'In-Person' %}selected{% endif %}>In-Person</option>
                                    <option value="Hybrid" {% if edit_job.interview_mode == 'Hybrid' %}selected{% endif %}>Hybrid</option>
                                </select>
                            </div>

                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn-success px-4">
                                    <i class="bi bi-check-circle me-2"></i>Update Job
                                </button>
                                <a href="/recruiter-dashboard?tab=jobs" class="btn btn-secondary">
                                    <i class="bi bi-x-circle me-2"></i>Cancel
                                </a>
                            </div>
                        </form>
                    </div>
                </div>
                {% else %}
                <div class="alert alert-danger">Job not found</div>
                {% endif %}
            </div>

            {% endif %}

            <style>
                .job-card {
                    transition: transform 0.2s, box-shadow 0.2s;
                }
                .job-card:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 8px 25px rgba(0,0,0,0.12) !important;
                }
                [data-bs-toggle="collapse"]:not(.collapsed) .show-more {
                    display: none !important;
                }
                [data-bs-toggle="collapse"]:not(.collapsed) .show-less {
                    display: inline !important;
                }
            </style>

            <script>
                function shareJob(btn) {
                    const jobId = btn.dataset.jobId;
                    const jobUrl = window.location.origin + '/view-job/' + jobId;

                    if (navigator.share) {
                        navigator.share({
                            title: 'Job Posting',
                            url: jobUrl
                        });
                    } else {
                        navigator.clipboard.writeText(jobUrl);
                        alert('Job link copied to clipboard!');
                    }
                }
                // Filter functionality
                document.getElementById('jobSearchInput')?.addEventListener('input', filterJobs);
                document.getElementById('statusFilter')?.addEventListener('change', filterJobs);
                document.getElementById('typeFilter')?.addEventListener('change', filterJobs);

                function filterJobs() {
                    const search = document.getElementById('jobSearchInput').value.toLowerCase();
                    const status = document.getElementById('statusFilter').value;
                    const type = document.getElementById('typeFilter').value;

                    document.querySelectorAll('.job-card').forEach(card => {
                        const text = card.textContent.toLowerCase();
                        const matchSearch = !search || text.includes(search);
                        const matchStatus = !status || text.includes(status.toLowerCase());
                        const matchType = !type || text.includes(type.toLowerCase());

                        card.style.display = (matchSearch && matchStatus && matchType) ? '' : 'none';
                    });
                }
            </script>

            {% endblock %}

        </div>
    </main>
</div>

<script>
    function toggleEditMode(show) {
        const edit = document.getElementById('edit-mode');
        const view = document.getElementById('view-mode');
        if (!edit) return;
        if (show) {
            edit.classList.remove('d-none');
            if (view) view.classList.add('d-none');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        } else {
            edit.classList.add('d-none');
            if (view) view.classList.remove('d-none');
        }
    }

    function toggleView(show) {
        const edit = document.getElementById('edit-mode');
        const view = document.getElementById('view-mode');
        if (!view) return;
        if (show) {
            view.classList.remove('d-none');
            if (edit) edit.classList.add('d-none');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    }
</script>
</body>
</html>